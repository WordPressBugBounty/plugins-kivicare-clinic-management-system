import{w as me,s as oe,o as de,j as e,v as ue,Q as ge,r as l,_ as a,D as O,E as pe,G as he,B as V,C as xe,x as ye,H as fe,U as ve}from"./index-ItgyTBA3.js";import{a as be}from"./useFrontendBookAppointment-17WoRcRV.js";import{Q as we}from"./queryClient-nMQh-nWs.js";const je=()=>typeof window<"u"&&window.kc_frontend?.prefix?window.kc_frontend.prefix:"kiviCare_",ke=je(),G=me.PhoneNumberUtil.getInstance(),Ne=x=>{try{return G.isValidNumber(G.parseAndKeepRawInput(x))}catch{return!1}};function _e({containerId:x}){const i=document.getElementById(x),p=i?.dataset?.initialTab||"",S=i?.dataset?.redirectUrl||"",F=i?.dataset?.loginText||"",I=i?.dataset?.registerText||"",d=i?.dataset?.recaptchaEnabled==="yes",u=i?.dataset?.recaptchaSiteKey||"",K=i?.dataset?.defaultCountry||"us",B=i?.dataset?.showOtherGender==="on",y=i?.dataset?.preselectClinicId?parseInt(i?.dataset?.preselectClinicId,10):0,Q=i?.dataset?.siteLogo||"",$=p==="login"||p==="register";let f=[];try{f=JSON.parse(i?.dataset?.enableUserRoles||"[]")}catch{f=[]}let v=[];try{i?.dataset?.allowedLoginRoles&&(v=JSON.parse(i.dataset.allowedLoginRoles))}catch{v=[]}const J=i?.dataset?.disableRegistration==="true";l.useEffect(()=>{if(i){const s=i.dataset.primaryColor,t=i.dataset.primaryHoverColor,c=i.dataset.secondaryColor,n=i.dataset.secondaryHoverColor;s&&(i.style.setProperty("--bs-primary",s),i.style.setProperty("--bs-primary-rgb",T(s)),i.style.setProperty("--iq-primary",s),i.style.setProperty("--iq-primary-dark",t||s)),t&&i.style.setProperty("--iq-primary-hover",t),c&&(i.style.setProperty("--bs-secondary",c),i.style.setProperty("--bs-secondary-rgb",T(c)),i.style.setProperty("--iq-secondary",c),i.style.setProperty("--iq-secondary-dark",n||c)),n&&i.style.setProperty("--iq-secondary-hover",n)}},[i]);const T=s=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return t?`${parseInt(t[1],16)}, ${parseInt(t[2],16)}, ${parseInt(t[3],16)}`:""},[b,W]=l.useState(p||"login"),[w,j]=l.useState(!1),[q,m]=l.useState({type:"",text:""}),[h,X]=l.useState([]),[A,Y]=l.useState(!1),[M,z]=l.useState(!1),[U,Z]=l.useState(!1),D=l.useMemo(()=>[{value:O(),label:a("Patient","kivicare-clinic-management-system")},{value:pe(),label:a("Doctor","kivicare-clinic-management-system")},{value:he(),label:a("Receptionist","kivicare-clinic-management-system")}],[]);l.useEffect(()=>{if(Array.isArray(f)){const s=D.filter(t=>f.some(c=>{const n=c.toLowerCase(),R=t.value.toLowerCase(),le=ke.toLowerCase();return n===R||le+n===R}));X(s.length>0?s:[{value:O(),label:a("Patient","kivicare-clinic-management-system")}])}},[D]);const{data:ee,isLoading:Se}=be({per_page:20,status:"1"}),se=ee?.data?.clinics||[{id:1,name:a("Default Clinic","kivicare-clinic-management-system")}];l.useEffect(()=>{if(d&&u){const s=document.createElement("script");return s.src=`https://www.google.com/recaptcha/api.js?render=${u}`,s.async=!0,s.defer=!0,document.body.appendChild(s),()=>{const t=document.querySelector(`script[src*="${u}"]`);t&&document.body.removeChild(t)}}},[d,u]);const{register:E,handleSubmit:ae,formState:{errors:g},watch:ie}=V({mode:"onBlur",defaultValues:{username:"",password:""}}),{register:o,handleSubmit:re,formState:{errors:r},reset:H,watch:L,setValue:k,control:te}=V({mode:"onBlur",defaultValues:{username:"",email:"",first_name:"",last_name:"",password:"",confirmPassword:"",mobile_number:"",gender:"",user_role:"",user_clinic:""}});l.useEffect(()=>{y>0&&k("user_clinic",y.toString())},[y,k]),l.useEffect(()=>{h.length===1&&k("user_role",h[0].value)},[h,k]);const N=l.useCallback(s=>{s!==b&&(W(s),m({type:"",text:""}))},[b]),_=l.useCallback(async s=>{if(!d||!u)return"";try{return await new Promise((t,c)=>{const n=()=>{window.grecaptcha&&window.grecaptcha.ready?window.grecaptcha.ready(t):setTimeout(n,100)};n(),setTimeout(()=>c(new Error("reCAPTCHA loading timeout")),1e4)}),await window.grecaptcha.execute(u,{action:s})}catch(t){throw console.error("reCAPTCHA error:",t),new Error(a("reCAPTCHA verification failed. Please try again.","kivicare-clinic-management-system"))}},[d,u]),C=xe(),ne=l.useCallback(async s=>{j(!0),m({type:"",text:""});try{let t="";d&&(t=await _("login"));const c={username:s.username?.trim(),password:s.password,remember:s.rememberMe||!1,recaptchaToken:t,allowed_roles:v},n=await C.mutateAsync(c);if(n.status){m({type:"success",text:n.message||a("Login successful. Redirecting...","kivicare-clinic-management-system")});const R=S||n.data?.redirect_url||window.location.href;setTimeout(()=>window.location.href=R,1e3)}else m({type:"error",text:n.message||a("Invalid username or password.","kivicare-clinic-management-system")})}catch(t){const c=t?.response?.data?.message||t?.message||a("Invalid username or password.","kivicare-clinic-management-system");m({type:"error",text:c})}finally{j(!1)}},[d,_,S,C,v]),P=ye(),ce=l.useCallback(async s=>{j(!0),m({type:"",text:""});try{let t="";if(d&&(t=await _("register")),!s.gender?.trim())throw new Error(a("Gender is required","kivicare-clinic-management-system"));if(!s.user_clinic)throw new Error(a("Clinic selection is required","kivicare-clinic-management-system"));if(!s.user_role?.trim())throw new Error(a("Role selection is required","kivicare-clinic-management-system"));const c={username:s.username.trim(),email:s.email.trim(),first_name:s.first_name.trim(),last_name:s.last_name.trim(),password:s.password,mobile_number:s.mobile_number,gender:s.gender,user_role:s.user_role,user_clinic:parseInt(s.user_clinic,10),recaptchaToken:t},n=await P.mutateAsync(c);n.status?(m({type:"success",text:n.message||a("Registration successful. You can now log in.","kivicare-clinic-management-system")}),H(),setTimeout(()=>N("login"),2e3)):m({type:"error",text:n.message||a("Registration failed. Please try again.","kivicare-clinic-management-system")})}catch(t){const c=t?.response?.data?.message||a("Registration failed. Please try again.","kivicare-clinic-management-system");m({type:"error",text:c})}finally{j(!1)}},[d,_,P,H,N]);return e.jsxs("div",{className:"kc-register-login-form",children:[q.text&&e.jsx("div",{className:`alert ${q.type==="success"?"alert-success":"alert-danger"} mb-4`,dangerouslySetInnerHTML:{__html:q.text}}),e.jsx("div",{className:"card p-0 mb-0",children:e.jsxs("div",{className:"card-body auth-card",children:[e.jsx("div",{className:"logo-img text-center mb-4",children:e.jsx("img",{src:Q||window.kc_frontend?.loader_image?.replace("loader.gif","logo.png"),alt:"KiviCare",height:"45",className:"logo-normal"})}),b==="login"&&e.jsxs("form",{className:"kc-login-form",onSubmit:ae(ne),children:[e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",htmlFor:"login-username",children:[a("Username","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"login-username",className:`form-control ${g.username?"is-invalid":""}`,placeholder:"username@example.com",...E("username",{required:a("Username is required","kivicare-clinic-management-system")})}),g.username&&e.jsx("div",{className:"invalid-feedback",children:g.username.message})]}),e.jsxs("div",{className:"custom-form-field mb-3 position-relative",children:[e.jsxs("label",{className:"mb-2",htmlFor:"login-password",children:[a("Password","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:A?"text":"password",id:"login-password",className:`form-control ${g.password?"is-invalid":""}`,placeholder:"********",...E("password",{required:a("Password is required","kivicare-clinic-management-system")})}),ie("password")&&e.jsx("button",{type:"button",className:"btn btn-sm btn-link position-absolute",style:{right:g.password?"35px":"10px",top:"42px"},onClick:()=>Y(s=>!s),tabIndex:-1,children:A?e.jsx("i",{className:"ph ph-eye-slash"}):e.jsx("i",{className:"ph ph-eye"})}),g.password&&e.jsx("div",{className:"invalid-feedback",children:g.password.message})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-4",children:[e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"remember-me",...E("rememberMe")}),e.jsx("label",{className:"form-check-label",htmlFor:"remember-me",children:a("Remember Me","kivicare-clinic-management-system")})]}),e.jsx("a",{href:`${window.kc_frontend?.home_url}/wp-login.php?action=lostpassword`,className:"forgot-pwd fw-semibold fst-italic",children:a("Forgot Password?","kivicare-clinic-management-system")})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("button",{type:"submit",className:"btn btn-primary w-100",disabled:w||C.isPending,children:e.jsx("span",{className:"text d-inline-block align-middle text-uppercase",children:w||C.isPending?a("Loading...","kivicare-clinic-management-system"):F||a("Login","kivicare-clinic-management-system")})}),!$&&!J&&e.jsx("div",{className:"d-flex align-items-center justify-content-center mt-3",children:e.jsxs("p",{className:"text-center mb-0 fw-medium",children:[e.jsxs("span",{className:"signup-rtl-space",children:[a("Don't have an account?","kivicare-clinic-management-system")," "]}),e.jsx("a",{href:"#",onClick:s=>{s.preventDefault(),N("register")},className:"text-secondary",children:I||a("Sign Up","kivicare-clinic-management-system")})]})})]})]}),b==="register"&&e.jsxs("form",{className:"kc-register-form",onSubmit:re(ce),children:[e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-username",children:[a("Username","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"register-username",className:`form-control ${r.username?"is-invalid":""}`,placeholder:a("Enter username","kivicare-clinic-management-system"),...o("username",{required:a("Username is required","kivicare-clinic-management-system")})}),r.username&&e.jsx("div",{className:"invalid-feedback",children:r.username.message})]}),e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-email",children:[a("Email","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"email",id:"register-email",className:`form-control ${r.email?"is-invalid":""}`,placeholder:"name@example.com",...o("email",{required:a("Email is required","kivicare-clinic-management-system"),pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:a("Please enter a valid email address","kivicare-clinic-management-system")}})}),r.email&&e.jsx("div",{className:"invalid-feedback",children:r.email.message})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"custom-form-field mb-3 mb-md-0",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-first-name",children:[a("First Name","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"register-first-name",className:`form-control ${r.first_name?"is-invalid":""}`,placeholder:a("First name","kivicare-clinic-management-system"),...o("first_name",{required:a("First name is required","kivicare-clinic-management-system")})}),r.first_name&&e.jsx("div",{className:"invalid-feedback",children:r.first_name.message})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"custom-form-field",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-last-name",children:[a("Last Name","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"register-last-name",className:`form-control ${r.last_name?"is-invalid":""}`,placeholder:a("Last name","kivicare-clinic-management-system"),...o("last_name",{required:a("Last name is required","kivicare-clinic-management-system")})}),r.last_name&&e.jsx("div",{className:"invalid-feedback",children:r.last_name.message})]})})]}),e.jsxs("div",{className:"custom-form-field mb-3 position-relative",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-password",children:[a("Password","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:M?"text":"password",id:"register-password",className:`form-control ${r.password?"is-invalid":""}`,placeholder:"********",...o("password",{required:a("Password is required","kivicare-clinic-management-system"),minLength:{value:8,message:a("Password must be at least 8 characters","kivicare-clinic-management-system")}})}),L("password")&&e.jsx("button",{type:"button",className:"btn btn-sm btn-link position-absolute",style:{right:r.password?"35px":"10px",top:"42px"},onClick:()=>z(s=>!s),tabIndex:-1,children:M?e.jsx("i",{className:"ph ph-eye-slash"}):e.jsx("i",{className:"ph ph-eye"})}),r.password&&e.jsx("div",{className:"invalid-feedback",children:r.password.message})]}),e.jsxs("div",{className:"custom-form-field mb-3 position-relative",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-confirm-password",children:[a("Confirm Password","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:U?"text":"password",id:"register-confirm-password",className:`form-control ${r.confirmPassword?"is-invalid":""}`,placeholder:"********",...o("confirmPassword",{required:a("Please confirm your password","kivicare-clinic-management-system"),validate:s=>s===L("password")||a("Passwords do not match","kivicare-clinic-management-system")})}),L("confirmPassword")&&e.jsx("button",{type:"button",className:"btn btn-sm btn-link position-absolute",style:{right:r.confirmPassword?"35px":"10px",top:"42px"},onClick:()=>Z(s=>!s),tabIndex:-1,children:U?e.jsx("i",{className:"ph ph-eye-slash"}):e.jsx("i",{className:"ph ph-eye"})}),r.confirmPassword&&e.jsx("div",{className:"invalid-feedback",children:r.confirmPassword.message})]}),e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",children:[a("Contact Number","kivicare-clinic-management-system")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(fe,{name:"mobile_number",control:te,rules:{required:a("Contact number is required","kivicare-clinic-management-system"),validate:s=>!s||/^\+\d{1,4}$/.test(s)?!0:Ne(s)||a("Please enter a valid contact number","kivicare-clinic-management-system")},render:({field:s})=>e.jsx(ve,{defaultCountry:K,value:s.value,onChange:s.onChange,inputStyle:{width:"100%"},countrySelectorStyleProps:{buttonStyle:{height:"45px"}},inputProps:{className:`form-control ${r.mobile_number?"is-invalid":""}`,placeholder:a("Enter contact number","kivicare-clinic-management-system"),style:{height:"45px"}}})}),r.mobile_number&&e.jsx("div",{className:"invalid-feedback d-block",children:r.mobile_number.message})]}),e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-gender",children:[a("Gender","kivicare-clinic-management-system")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("select",{id:"register-gender",className:`form-select ${r.gender?"is-invalid":""}`,...o("gender",{required:a("Gender is required","kivicare-clinic-management-system")}),children:[e.jsx("option",{value:"",children:a("Select Gender","kivicare-clinic-management-system")}),e.jsx("option",{value:"male",children:a("Male","kivicare-clinic-management-system")}),e.jsx("option",{value:"female",children:a("Female","kivicare-clinic-management-system")}),B&&e.jsx("option",{value:"other",children:a("Other","kivicare-clinic-management-system")})]}),r.gender&&e.jsx("div",{className:"invalid-feedback",children:r.gender.message})]}),e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-user-role",children:[a("Select Role","kivicare-clinic-management-system")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("select",{id:"register-user-role",className:`form-select ${r.user_role?"is-invalid":""}`,...o("user_role",{required:a("Role is required","kivicare-clinic-management-system"),validate:s=>s?h.some(t=>t.value===s)||a("Selected role is not available","kivicare-clinic-management-system"):a("Please select a role","kivicare-clinic-management-system")}),defaultValue:"",children:[e.jsx("option",{value:"",children:a("Select Role","kivicare-clinic-management-system")}),h.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),r.user_role&&e.jsx("div",{className:"invalid-feedback",children:r.user_role.message})]}),y===0&&e.jsxs("div",{className:"custom-form-field mb-4",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-clinic",children:[a("Select Clinic","kivicare-clinic-management-system")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("select",{id:"register-clinic",className:`form-select ${r.user_clinic?"is-invalid":""}`,...o("user_clinic",{required:a("Clinic is required","kivicare-clinic-management-system")}),children:[e.jsx("option",{value:"",children:a("Select Clinic","kivicare-clinic-management-system")}),se.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),r.user_clinic&&e.jsx("div",{className:"invalid-feedback",children:r.user_clinic.message})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("button",{type:"submit",className:"btn btn-primary w-100",disabled:w||P.isPending,children:e.jsx("span",{className:"text d-inline-block align-middle text-uppercase",children:w||P.isPending?a("Loading...","kivicare-clinic-management-system"):I||a("Register","kivicare-clinic-management-system")})}),!$&&e.jsx("div",{className:"d-flex align-items-center justify-content-center mt-3",children:e.jsxs("p",{className:"text-center mb-0 fw-medium",children:[e.jsxs("span",{className:"signup-rtl-space",children:[a("Already have an account?","kivicare-clinic-management-system")," "]}),e.jsx("a",{href:"#",onClick:s=>{s.preventDefault(),N("login")},className:"text-secondary",children:F||a("Log In","kivicare-clinic-management-system")})]})})]})]})]})})]})}const Ce=new we({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}}),Pe=window.kc_frontend?.locale_data||{"":{}};oe(Pe,"kivicare-clinic-management-system");const Re=()=>{document.querySelectorAll(".kc-register-login-container").forEach(i=>{const p=i.id;de.createRoot(i).render(e.jsx(ue.StrictMode,{children:e.jsx(ge,{client:Ce,children:e.jsx(_e,{containerId:p})})}))})};document.addEventListener("DOMContentLoaded",Re);

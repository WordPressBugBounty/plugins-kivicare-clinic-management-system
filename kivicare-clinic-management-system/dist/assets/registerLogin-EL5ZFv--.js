import{w as le,b as me,o as oe,j as e,v as de,Q as ue,r as c,_ as a,D as H,E as ge,G as pe,z as V,B as he,x as ye,H as xe,U as fe}from"./index-C8ThEdOa.js";/* empty css               */import{a as ve}from"./useFrontendBookAppointment-COTwTVvL.js";import{Q as be}from"./queryClient-Dib6V5J3.js";const we=()=>typeof window<"u"&&window.kc_frontend?.prefix?window.kc_frontend.prefix:"kiviCare_",je=we(),G=le.PhoneNumberUtil.getInstance(),ke=y=>{try{return G.isValidNumber(G.parseAndKeepRawInput(y))}catch{return!1}};function Ne({containerId:y}){const r=document.getElementById(y),p=r?.dataset?.initialTab||"",R=r?.dataset?.redirectUrl||"",L=r?.dataset?.loginText||"",F=r?.dataset?.registerText||"",d=r?.dataset?.recaptchaEnabled==="yes",u=r?.dataset?.recaptchaSiteKey||"",O=r?.dataset?.defaultCountry||"us",K=r?.dataset?.showOtherGender==="on",x=r?.dataset?.preselectClinicId?parseInt(r?.dataset?.preselectClinicId,10):0,B=r?.dataset?.siteLogo||"",I=p==="login"||p==="register";let f=[];try{f=JSON.parse(r?.dataset?.enableUserRoles||"[]")}catch{f=[]}c.useEffect(()=>{if(r){const s=r.dataset.primaryColor,t=r.dataset.primaryHoverColor,l=r.dataset.secondaryColor,n=r.dataset.secondaryHoverColor;s&&(r.style.setProperty("--bs-primary",s),r.style.setProperty("--bs-primary-rgb",$(s)),r.style.setProperty("--iq-primary",s),r.style.setProperty("--iq-primary-dark",t||s)),t&&r.style.setProperty("--iq-primary-hover",t),l&&(r.style.setProperty("--bs-secondary",l),r.style.setProperty("--bs-secondary-rgb",$(l)),r.style.setProperty("--iq-secondary",l),r.style.setProperty("--iq-secondary-dark",n||l)),n&&r.style.setProperty("--iq-secondary-hover",n)}},[r]);const $=s=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return t?`${parseInt(t[1],16)}, ${parseInt(t[2],16)}, ${parseInt(t[3],16)}`:""},[v,Q]=c.useState(p||"login"),[b,w]=c.useState(!1),[S,m]=c.useState({type:"",text:""}),[h,W]=c.useState([]),[T,z]=c.useState(!1),[A,J]=c.useState(!1),[U,X]=c.useState(!1),D=c.useMemo(()=>[{value:H(),label:a("Patient","kivicare-clinic-management-system")},{value:ge(),label:a("Doctor","kivicare-clinic-management-system")},{value:pe(),label:a("Receptionist","kivicare-clinic-management-system")}],[]);c.useEffect(()=>{if(Array.isArray(f)){const s=D.filter(t=>f.some(l=>{const n=l.toLowerCase(),C=t.value.toLowerCase(),ce=je.toLowerCase();return n===C||ce+n===C}));W(s.length>0?s:[{value:H(),label:a("Patient","kivicare-clinic-management-system")}])}},[D]);const{data:Y,isLoading:Z}=ve({per_page:20,status:"1"}),ee=Y?.data?.clinics||[{id:1,name:a("Default Clinic","kivicare-clinic-management-system")}];c.useEffect(()=>{if(d&&u){const s=document.createElement("script");return s.src=`https://www.google.com/recaptcha/api.js?render=${u}`,s.async=!0,s.defer=!0,document.body.appendChild(s),()=>{const t=document.querySelector(`script[src*="${u}"]`);t&&document.body.removeChild(t)}}},[d,u]);const{register:q,handleSubmit:se,formState:{errors:g},watch:ae}=V({mode:"onBlur",defaultValues:{username:"",password:""}}),{register:o,handleSubmit:ie,formState:{errors:i},reset:M,watch:E,setValue:j,control:re}=V({mode:"onBlur",defaultValues:{username:"",email:"",first_name:"",last_name:"",password:"",confirmPassword:"",mobile_number:"",gender:"",user_role:"",user_clinic:""}});c.useEffect(()=>{x>0&&j("user_clinic",x.toString())},[x,j]),c.useEffect(()=>{h.length===1&&j("user_role",h[0].value)},[h,j]);const k=c.useCallback(s=>{s!==v&&(Q(s),m({type:"",text:""}))},[v]),N=c.useCallback(async s=>{if(!d||!u)return"";try{return await new Promise((t,l)=>{const n=()=>{window.grecaptcha&&window.grecaptcha.ready?window.grecaptcha.ready(t):setTimeout(n,100)};n(),setTimeout(()=>l(new Error("reCAPTCHA loading timeout")),1e4)}),await window.grecaptcha.execute(u,{action:s})}catch(t){throw console.error("reCAPTCHA error:",t),new Error(a("reCAPTCHA verification failed. Please try again.","kivicare-clinic-management-system"))}},[d,u]),P=he(),te=c.useCallback(async s=>{w(!0),m({type:"",text:""});try{let t="";d&&(t=await N("login"));const l={username:s.username?.trim(),password:s.password,remember:s.rememberMe||!1,recaptchaToken:t},n=await P.mutateAsync(l);if(n.status){m({type:"success",text:n.message||a("Login successful. Redirecting...","kivicare-clinic-management-system")});const C=R||n.data?.redirect_url||window.location.href;setTimeout(()=>window.location.href=C,1e3)}else m({type:"error",text:n.message||a("Invalid username or password.","kivicare-clinic-management-system")})}catch(t){m({type:"error",text:t?.message||a("Invalid username or password.","kivicare-clinic-management-system")})}finally{w(!1)}},[d,N,R,P]),_=ye(),ne=c.useCallback(async s=>{w(!0),m({type:"",text:""});try{let t="";if(d&&(t=await N("register")),!s.gender?.trim())throw new Error(a("Gender is required","kivicare-clinic-management-system"));if(!s.user_clinic)throw new Error(a("Clinic selection is required","kivicare-clinic-management-system"));if(!s.user_role?.trim())throw new Error(a("Role selection is required","kivicare-clinic-management-system"));const l={username:s.username.trim(),email:s.email.trim(),first_name:s.first_name.trim(),last_name:s.last_name.trim(),password:s.password,mobile_number:s.mobile_number,gender:s.gender,user_role:s.user_role,user_clinic:parseInt(s.user_clinic,10),recaptchaToken:t},n=await _.mutateAsync(l);n.status?(m({type:"success",text:n.message||a("Registration successful. You can now log in.","kivicare-clinic-management-system")}),M(),setTimeout(()=>k("login"),2e3)):m({type:"error",text:n.message||a("Registration failed. Please try again.","kivicare-clinic-management-system")})}catch(t){const l=t?.response?.data?.message||a("Registration failed. Please try again.","kivicare-clinic-management-system");m({type:"error",text:l})}finally{w(!1)}},[d,N,_,M,k]);return Z?e.jsx("div",{children:a("Loading...","kivicare-clinic-management-system")}):e.jsxs("div",{className:"kc-register-login-form",children:[S.text&&e.jsx("div",{className:`alert ${S.type==="success"?"alert-success":"alert-danger"} mb-4`,dangerouslySetInnerHTML:{__html:S.text}}),e.jsx("div",{className:"card p-0 mb-0",children:e.jsxs("div",{className:"card-body auth-card",children:[e.jsx("div",{className:"logo-img text-center mb-4",children:e.jsx("img",{src:B||window.kc_frontend?.loader_image?.replace("loader.gif","logo.png"),alt:"KiviCare",height:"45",className:"logo-normal"})}),v==="login"&&e.jsxs("form",{className:"kc-login-form",onSubmit:se(te),children:[e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",htmlFor:"login-username",children:[a("Username","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"login-username",className:`form-control ${g.username?"is-invalid":""}`,placeholder:"username@example.com",...q("username",{required:a("Username is required","kivicare-clinic-management-system")})}),g.username&&e.jsx("div",{className:"invalid-feedback",children:g.username.message})]}),e.jsxs("div",{className:"custom-form-field mb-3 position-relative",children:[e.jsxs("label",{className:"mb-2",htmlFor:"login-password",children:[a("Password","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:T?"text":"password",id:"login-password",className:`form-control ${g.password?"is-invalid":""}`,placeholder:"********",...q("password",{required:a("Password is required","kivicare-clinic-management-system")})}),ae("password")&&e.jsx("button",{type:"button",className:"btn btn-sm btn-link position-absolute",style:{right:g.password?"35px":"10px",top:"42px"},onClick:()=>z(s=>!s),tabIndex:-1,children:T?e.jsx("i",{className:"ph ph-eye-slash"}):e.jsx("i",{className:"ph ph-eye"})}),g.password&&e.jsx("div",{className:"invalid-feedback",children:g.password.message})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-4",children:[e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"remember-me",...q("rememberMe")}),e.jsx("label",{className:"form-check-label",htmlFor:"remember-me",children:a("Remember Me","kivicare-clinic-management-system")})]}),e.jsx("a",{href:`${window.kc_frontend?.home_url}/wp-login.php?action=lostpassword`,className:"forgot-pwd fw-semibold fst-italic",children:a("Forgot Password?","kivicare-clinic-management-system")})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("button",{type:"submit",className:"btn btn-primary w-100",disabled:b||P.isPending,children:e.jsx("span",{className:"text d-inline-block align-middle text-uppercase",children:b||P.isPending?a("Loading...","kivicare-clinic-management-system"):L||a("Login","kivicare-clinic-management-system")})}),!I&&e.jsx("div",{className:"d-flex align-items-center justify-content-center mt-3",children:e.jsxs("p",{className:"text-center mb-0 fw-medium",children:[e.jsxs("span",{className:"signup-rtl-space",children:[a("Don't have an account?","kivicare-clinic-management-system")," "]}),e.jsx("a",{href:"#",onClick:s=>{s.preventDefault(),k("register")},className:"text-secondary",children:F||a("Sign Up","kivicare-clinic-management-system")})]})})]})]}),v==="register"&&e.jsxs("form",{className:"kc-register-form",onSubmit:ie(ne),children:[e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-username",children:[a("Username","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"register-username",className:`form-control ${i.username?"is-invalid":""}`,placeholder:a("Enter username","kivicare-clinic-management-system"),...o("username",{required:a("Username is required","kivicare-clinic-management-system")})}),i.username&&e.jsx("div",{className:"invalid-feedback",children:i.username.message})]}),e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-email",children:[a("Email","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"email",id:"register-email",className:`form-control ${i.email?"is-invalid":""}`,placeholder:"name@example.com",...o("email",{required:a("Email is required","kivicare-clinic-management-system"),pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:a("Please enter a valid email address","kivicare-clinic-management-system")}})}),i.email&&e.jsx("div",{className:"invalid-feedback",children:i.email.message})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"custom-form-field mb-3 mb-md-0",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-first-name",children:[a("First Name","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"register-first-name",className:`form-control ${i.first_name?"is-invalid":""}`,placeholder:a("First name","kivicare-clinic-management-system"),...o("first_name",{required:a("First name is required","kivicare-clinic-management-system")})}),i.first_name&&e.jsx("div",{className:"invalid-feedback",children:i.first_name.message})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"custom-form-field",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-last-name",children:[a("Last Name","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"register-last-name",className:`form-control ${i.last_name?"is-invalid":""}`,placeholder:a("Last name","kivicare-clinic-management-system"),...o("last_name",{required:a("Last name is required","kivicare-clinic-management-system")})}),i.last_name&&e.jsx("div",{className:"invalid-feedback",children:i.last_name.message})]})})]}),e.jsxs("div",{className:"custom-form-field mb-3 position-relative",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-password",children:[a("Password","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:A?"text":"password",id:"register-password",className:`form-control ${i.password?"is-invalid":""}`,placeholder:"********",...o("password",{required:a("Password is required","kivicare-clinic-management-system"),minLength:{value:8,message:a("Password must be at least 8 characters","kivicare-clinic-management-system")}})}),E("password")&&e.jsx("button",{type:"button",className:"btn btn-sm btn-link position-absolute",style:{right:i.password?"35px":"10px",top:"42px"},onClick:()=>J(s=>!s),tabIndex:-1,children:A?e.jsx("i",{className:"ph ph-eye-slash"}):e.jsx("i",{className:"ph ph-eye"})}),i.password&&e.jsx("div",{className:"invalid-feedback",children:i.password.message})]}),e.jsxs("div",{className:"custom-form-field mb-3 position-relative",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-confirm-password",children:[a("Confirm Password","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:U?"text":"password",id:"register-confirm-password",className:`form-control ${i.confirmPassword?"is-invalid":""}`,placeholder:"********",...o("confirmPassword",{required:a("Please confirm your password","kivicare-clinic-management-system"),validate:s=>s===E("password")||a("Passwords do not match","kivicare-clinic-management-system")})}),E("confirmPassword")&&e.jsx("button",{type:"button",className:"btn btn-sm btn-link position-absolute",style:{right:i.confirmPassword?"35px":"10px",top:"42px"},onClick:()=>X(s=>!s),tabIndex:-1,children:U?e.jsx("i",{className:"ph ph-eye-slash"}):e.jsx("i",{className:"ph ph-eye"})}),i.confirmPassword&&e.jsx("div",{className:"invalid-feedback",children:i.confirmPassword.message})]}),e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",children:[a("Contact Number","kivicare-clinic-management-system")," *"]}),e.jsx(xe,{name:"mobile_number",control:re,rules:{required:a("Contact number is required","kivicare-clinic-management-system"),validate:s=>!s||/^\+\d{1,4}$/.test(s)?!0:ke(s)||a("Please enter a valid contact number","kivicare-clinic-management-system")},render:({field:s})=>e.jsx(fe,{defaultCountry:O,value:s.value,onChange:s.onChange,inputStyle:{width:"100%"},countrySelectorStyleProps:{buttonStyle:{height:"45px"}},inputProps:{className:`form-control ${i.mobile_number?"is-invalid":""}`,placeholder:a("Enter contact number","kivicare-clinic-management-system"),style:{height:"45px"}}})}),i.mobile_number&&e.jsx("div",{className:"invalid-feedback d-block",children:i.mobile_number.message})]}),e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-gender",children:[a("Gender","kivicare-clinic-management-system")," *"]}),e.jsxs("select",{id:"register-gender",className:`form-select ${i.gender?"is-invalid":""}`,...o("gender",{required:a("Gender is required","kivicare-clinic-management-system")}),children:[e.jsx("option",{value:"",children:a("Select Gender","kivicare-clinic-management-system")}),e.jsx("option",{value:"male",children:a("Male","kivicare-clinic-management-system")}),e.jsx("option",{value:"female",children:a("Female","kivicare-clinic-management-system")}),K&&e.jsx("option",{value:"other",children:a("Other","kivicare-clinic-management-system")})]}),i.gender&&e.jsx("div",{className:"invalid-feedback",children:i.gender.message})]}),e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-user-role",children:[a("Select Role","kivicare-clinic-management-system")," *"]}),e.jsxs("select",{id:"register-user-role",className:`form-select ${i.user_role?"is-invalid":""}`,...o("user_role",{required:a("Role is required","kivicare-clinic-management-system"),validate:s=>s?h.some(t=>t.value===s)||a("Selected role is not available","kivicare-clinic-management-system"):a("Please select a role","kivicare-clinic-management-system")}),defaultValue:"",children:[e.jsx("option",{value:"",children:a("Select Role","kivicare-clinic-management-system")}),h.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),i.user_role&&e.jsx("div",{className:"invalid-feedback",children:i.user_role.message})]}),x===0&&e.jsxs("div",{className:"custom-form-field mb-4",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-clinic",children:[a("Select Clinic","kivicare-clinic-management-system")," *"]}),e.jsxs("select",{id:"register-clinic",className:`form-select ${i.user_clinic?"is-invalid":""}`,...o("user_clinic",{required:a("Clinic is required","kivicare-clinic-management-system")}),children:[e.jsx("option",{value:"",children:a("Select Clinic","kivicare-clinic-management-system")}),ee.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),i.user_clinic&&e.jsx("div",{className:"invalid-feedback",children:i.user_clinic.message})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("button",{type:"submit",className:"btn btn-primary w-100",disabled:b||_.isPending,children:e.jsx("span",{className:"text d-inline-block align-middle text-uppercase",children:b||_.isPending?a("Loading...","kivicare-clinic-management-system"):F||a("Register","kivicare-clinic-management-system")})}),!I&&e.jsx("div",{className:"d-flex align-items-center justify-content-center mt-3",children:e.jsxs("p",{className:"text-center mb-0 fw-medium",children:[e.jsxs("span",{className:"signup-rtl-space",children:[a("Already have an account?","kivicare-clinic-management-system")," "]}),e.jsx("a",{href:"#",onClick:s=>{s.preventDefault(),k("login")},className:"text-secondary",children:L||a("Log In","kivicare-clinic-management-system")})]})})]})]})]})})]})}const Pe=new be({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}}),_e=window.kc_frontend?.locale_data||{"":{}};me(_e,"kivicare-clinic-management-system");const Ce=()=>{document.querySelectorAll(".kc-register-login-container").forEach(r=>{const p=r.id;oe.createRoot(r).render(e.jsx(de.StrictMode,{children:e.jsx(ue,{client:Pe,children:e.jsx(Ne,{containerId:p})})}))})};document.addEventListener("DOMContentLoaded",Ce);

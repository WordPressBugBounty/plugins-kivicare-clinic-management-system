import{aj as fe,I as xe,ad as ye,j as e,ag as ve,ah as be,r as n,_ as a,aS as X,aT as we,aU as je,ao as Y,ax as ke,ar as Ne,ak as _e,aV as Ce,ap as Pe,aq as Re}from"./TransitionRoutes-CT0W_aAZ.js";import{a as Se}from"./useFrontendBookAppointment-qbRwIzQr.js";import{Q as qe}from"./queryClient-C-xfj7Xx.js";const Fe=()=>typeof window<"u"&&window.kc_frontend?.prefix?window.kc_frontend.prefix:"kiviCare_",Ee=Fe(),z=fe.PhoneNumberUtil.getInstance(),Le=v=>{try{return z.isValidNumber(z.parseAndKeepRawInput(v))}catch{return!1}};function Ie({containerId:v}){const i=document.getElementById(v),h=i?.dataset?.initialTab||"",L=i?.dataset?.redirectUrl||"",A=i?.dataset?.loginText||"",U=i?.dataset?.registerText||"",d=i?.dataset?.recaptchaEnabled==="yes",g=i?.dataset?.recaptchaSiteKey||"",Z=i?.dataset?.defaultCountry||"us",ee=i?.dataset?.showOtherGender==="on",b=i?.dataset?.preselectClinicId?parseInt(i?.dataset?.preselectClinicId,10):0,se=i?.dataset?.siteLogo||"",D=h==="login"||h==="register";let w=[];try{w=JSON.parse(i?.dataset?.enableUserRoles||"[]")}catch{w=[]}let j=[];try{i?.dataset?.allowedLoginRoles&&(j=JSON.parse(i.dataset.allowedLoginRoles))}catch{j=[]}const ae=i?.dataset?.disableRegistration==="true";n.useEffect(()=>{if(i){const s=i.dataset.primaryColor,r=i.dataset.primaryHoverColor,c=i.dataset.secondaryColor,l=i.dataset.secondaryHoverColor;s&&(i.style.setProperty("--bs-primary",s),i.style.setProperty("--bs-primary-rgb",V(s)),i.style.setProperty("--iq-primary",s),i.style.setProperty("--iq-primary-dark",r||s)),r&&i.style.setProperty("--iq-primary-hover",r),c&&(i.style.setProperty("--bs-secondary",c),i.style.setProperty("--bs-secondary-rgb",V(c)),i.style.setProperty("--iq-secondary",c),i.style.setProperty("--iq-secondary-dark",l||c)),l&&i.style.setProperty("--iq-secondary-hover",l)}},[i]);const V=s=>{const r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return r?`${parseInt(r[1],16)}, ${parseInt(r[2],16)}, ${parseInt(r[3],16)}`:""},[k,ie]=n.useState(h||"login"),[N,_]=n.useState(!1),[I,o]=n.useState({type:"",text:""}),[f,te]=n.useState([]),[H,re]=n.useState(!1),[O,ne]=n.useState(!1),[G,ce]=n.useState(!1),[T,K]=n.useState([]),B=n.useMemo(()=>[{value:X(),label:a("Patient","kivicare-clinic-management-system")},{value:we(),label:a("Doctor","kivicare-clinic-management-system")},{value:je(),label:a("Receptionist","kivicare-clinic-management-system")}],[]);n.useEffect(()=>{if(Array.isArray(w)){const s=B.filter(r=>w.some(c=>{const l=c.toLowerCase(),u=r.value.toLowerCase(),E=Ee.toLowerCase();return l===u||E+l===u}));te(s.length>0?s:[{value:X(),label:a("Patient","kivicare-clinic-management-system")}])}},[B]);const{data:le,isLoading:Ae}=Se({per_page:20,status:"1"}),oe=le?.data?.clinics||[{id:1,name:a("Default Clinic","kivicare-clinic-management-system")}];n.useEffect(()=>{if(d&&g){const s=document.createElement("script");return s.src=`https://www.google.com/recaptcha/api.js?render=${g}`,s.async=!0,s.defer=!0,document.body.appendChild(s),()=>{const r=document.querySelector(`script[src*="${g}"]`);r&&document.body.removeChild(r)}}},[d,g]);const{register:$,handleSubmit:me,formState:{errors:p},watch:de}=Y({mode:"onBlur",defaultValues:{username:"",password:""}}),{register:m,handleSubmit:ue,formState:{errors:t},reset:Q,watch:x,setValue:y,control:J}=Y({mode:"onBlur",defaultValues:{username:"",email:"",first_name:"",last_name:"",password:"",confirmPassword:"",mobile_number:"",gender:"",user_role:"",user_clinic:""}});n.useEffect(()=>{b>0&&y("user_clinic",b.toString())},[b,y]),n.useEffect(()=>{f.length===1&&y("user_role",f[0].value)},[f,y]);const C=x("user_role"),P=n.useMemo(()=>C?C.includes("doctor")?"doctor_module":C.includes("patient")?"patient_module":"":"",[C]),{data:M}=ke(P);n.useEffect(()=>{P&&M?.data?K(M.data):K([])},[M,P]);const R=n.useCallback(s=>{s!==k&&(ie(s),o({type:"",text:""}))},[k]),S=n.useCallback(async s=>{if(!d||!g)return"";try{return await new Promise((r,c)=>{const l=()=>{window.grecaptcha&&window.grecaptcha.ready?window.grecaptcha.ready(r):setTimeout(l,100)};l(),setTimeout(()=>c(new Error("reCAPTCHA loading timeout")),1e4)}),await window.grecaptcha.execute(g,{action:s})}catch(r){throw console.error("reCAPTCHA error:",r),new Error(a("reCAPTCHA verification failed. Please try again.","kivicare-clinic-management-system"))}},[d,g]),q=Ne(),ge=n.useCallback(async s=>{_(!0),o({type:"",text:""});try{let r="";d&&(r=await S("login"));const c={username:s.username?.trim(),password:s.password,remember:s.rememberMe||!1,recaptchaToken:r,allowed_roles:j},l=await q.mutateAsync(c);if(l.status){o({type:"success",text:l.message||a("Login successful. Redirecting...","kivicare-clinic-management-system")});const u=L||l.data?.redirect_url||window.location.href;setTimeout(()=>window.location.href=u,1e3)}else o({type:"error",text:l.message||a("Invalid username or password.","kivicare-clinic-management-system")})}catch(r){const c=r?.response?.data?.message||r?.message||a("Invalid username or password.","kivicare-clinic-management-system");o({type:"error",text:c})}finally{_(!1)}},[d,S,L,q,j]),F=_e(),pe=n.useCallback(async s=>{_(!0),o({type:"",text:""});try{let r="";if(d&&(r=await S("register")),!s.gender?.trim())throw new Error(a("Gender is required","kivicare-clinic-management-system"));if(!s.user_clinic)throw new Error(a("Clinic selection is required","kivicare-clinic-management-system"));if(!s.user_role?.trim())throw new Error(a("Role selection is required","kivicare-clinic-management-system"));const c={};T.forEach(E=>{const he=`custom_field_${E.id}`,W=s[he];W!==void 0&&(c[E.id]=W)});const l={username:s.username.trim(),email:s.email.trim(),first_name:s.first_name.trim(),last_name:s.last_name.trim(),password:s.password,mobile_number:s.mobile_number,gender:s.gender,user_role:s.user_role,user_clinic:parseInt(s.user_clinic,10),recaptchaToken:r,custom_fields:c},u=await F.mutateAsync(l);u.status?(o({type:"success",text:u.message||a("Registration successful. You can now log in.","kivicare-clinic-management-system")}),Q(),setTimeout(()=>R("login"),2e3)):o({type:"error",text:u.message||a("Registration failed. Please try again.","kivicare-clinic-management-system")})}catch(r){const c=r?.response?.data?.message||a("Registration failed. Please try again.","kivicare-clinic-management-system");o({type:"error",text:c})}finally{_(!1)}},[d,S,F,Q,R,T]);return e.jsxs("div",{className:"kc-register-login-form",children:[I.text&&e.jsx("div",{className:`alert ${I.type==="success"?"alert-success":"alert-danger"} mb-4`,dangerouslySetInnerHTML:{__html:I.text}}),e.jsx("div",{className:"card p-0 mb-0",children:e.jsxs("div",{className:"card-body auth-card",children:[e.jsx("div",{className:"logo-img text-center mb-4",children:e.jsx("img",{src:se||window.kc_frontend?.loader_image?.replace("loader.gif","logo.png"),alt:"KiviCare",height:"45",className:"logo-normal"})}),k==="login"&&e.jsxs("form",{className:"kc-login-form",onSubmit:me(ge),children:[e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",htmlFor:"login-username",children:[a("Username","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"login-username",className:`form-control ${p.username?"is-invalid":""}`,placeholder:"username@example.com",...$("username",{required:a("Username is required","kivicare-clinic-management-system")})}),p.username&&e.jsx("div",{className:"invalid-feedback",children:p.username.message})]}),e.jsxs("div",{className:"custom-form-field mb-3 position-relative",children:[e.jsxs("label",{className:"mb-2",htmlFor:"login-password",children:[a("Password","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:H?"text":"password",id:"login-password",className:`form-control ${p.password?"is-invalid":""}`,placeholder:"********",...$("password",{required:a("Password is required","kivicare-clinic-management-system")})}),de("password")&&e.jsx("button",{type:"button",className:"btn btn-sm btn-link position-absolute",style:{right:p.password?"35px":"10px",top:"42px"},onClick:()=>re(s=>!s),tabIndex:-1,children:H?e.jsx("i",{className:"ph ph-eye-slash"}):e.jsx("i",{className:"ph ph-eye"})}),p.password&&e.jsx("div",{className:"invalid-feedback",children:p.password.message})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-4",children:[e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"remember-me",...$("rememberMe")}),e.jsx("label",{className:"form-check-label",htmlFor:"remember-me",children:a("Remember Me","kivicare-clinic-management-system")})]}),e.jsx("a",{href:`${window.kc_frontend?.home_url}/wp-login.php?action=lostpassword`,className:"forgot-pwd fw-semibold fst-italic",children:a("Forgot Password?","kivicare-clinic-management-system")})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("button",{type:"submit",className:"btn btn-primary w-100",disabled:N||q.isPending,children:e.jsx("span",{className:"text d-inline-block align-middle text-uppercase",children:N||q.isPending?a("Loading...","kivicare-clinic-management-system"):A||a("Login","kivicare-clinic-management-system")})}),!D&&!ae&&e.jsx("div",{className:"d-flex align-items-center justify-content-center mt-3",children:e.jsxs("p",{className:"text-center mb-0 fw-medium",children:[e.jsxs("span",{className:"signup-rtl-space",children:[a("Don't have an account?","kivicare-clinic-management-system")," "]}),e.jsx("a",{href:"#",onClick:s=>{s.preventDefault(),R("register")},className:"text-secondary",children:U||a("Sign Up","kivicare-clinic-management-system")})]})})]})]}),k==="register"&&e.jsxs("form",{className:"kc-register-form",onSubmit:ue(pe),children:[e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-username",children:[a("Username","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"register-username",className:`form-control ${t.username?"is-invalid":""}`,placeholder:a("Enter username","kivicare-clinic-management-system"),...m("username",{required:a("Username is required","kivicare-clinic-management-system")})}),t.username&&e.jsx("div",{className:"invalid-feedback",children:t.username.message})]}),e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-email",children:[a("Email","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"email",id:"register-email",className:`form-control ${t.email?"is-invalid":""}`,placeholder:"name@example.com",...m("email",{required:a("Email is required","kivicare-clinic-management-system"),pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:a("Please enter a valid email address","kivicare-clinic-management-system")}})}),t.email&&e.jsx("div",{className:"invalid-feedback",children:t.email.message})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"custom-form-field mb-3 mb-md-0",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-first-name",children:[a("First Name","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"register-first-name",className:`form-control ${t.first_name?"is-invalid":""}`,placeholder:a("First name","kivicare-clinic-management-system"),...m("first_name",{required:a("First name is required","kivicare-clinic-management-system")})}),t.first_name&&e.jsx("div",{className:"invalid-feedback",children:t.first_name.message})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"custom-form-field",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-last-name",children:[a("Last Name","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"register-last-name",className:`form-control ${t.last_name?"is-invalid":""}`,placeholder:a("Last name","kivicare-clinic-management-system"),...m("last_name",{required:a("Last name is required","kivicare-clinic-management-system")})}),t.last_name&&e.jsx("div",{className:"invalid-feedback",children:t.last_name.message})]})})]}),e.jsxs("div",{className:"custom-form-field mb-3 position-relative",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-password",children:[a("Password","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:O?"text":"password",id:"register-password",className:`form-control ${t.password?"is-invalid":""}`,placeholder:"********",...m("password",{required:a("Password is required","kivicare-clinic-management-system"),minLength:{value:8,message:a("Password must be at least 8 characters","kivicare-clinic-management-system")}})}),x("password")&&e.jsx("button",{type:"button",className:"btn btn-sm btn-link position-absolute",style:{right:t.password?"35px":"10px",top:"42px"},onClick:()=>ne(s=>!s),tabIndex:-1,children:O?e.jsx("i",{className:"ph ph-eye-slash"}):e.jsx("i",{className:"ph ph-eye"})}),t.password&&e.jsx("div",{className:"invalid-feedback",children:t.password.message})]}),e.jsxs("div",{className:"custom-form-field mb-3 position-relative",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-confirm-password",children:[a("Confirm Password","kivicare-clinic-management-system"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:G?"text":"password",id:"register-confirm-password",className:`form-control ${t.confirmPassword?"is-invalid":""}`,placeholder:"********",...m("confirmPassword",{required:a("Please confirm your password","kivicare-clinic-management-system"),validate:s=>s===x("password")||a("Passwords do not match","kivicare-clinic-management-system")})}),x("confirmPassword")&&e.jsx("button",{type:"button",className:"btn btn-sm btn-link position-absolute",style:{right:t.confirmPassword?"35px":"10px",top:"42px"},onClick:()=>ce(s=>!s),tabIndex:-1,children:G?e.jsx("i",{className:"ph ph-eye-slash"}):e.jsx("i",{className:"ph ph-eye"})}),t.confirmPassword&&e.jsx("div",{className:"invalid-feedback",children:t.confirmPassword.message})]}),e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",children:[a("Contact Number","kivicare-clinic-management-system")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(Ce,{name:"mobile_number",control:J,rules:{required:a("Contact number is required","kivicare-clinic-management-system"),validate:s=>!s||/^\+\d{1,4}$/.test(s)?!0:Le(s)||a("Please enter a valid contact number","kivicare-clinic-management-system")},render:({field:s})=>e.jsx(Pe,{defaultCountry:Z,value:s.value,onChange:s.onChange,inputStyle:{width:"100%"},countrySelectorStyleProps:{buttonStyle:{height:"45px"}},inputProps:{className:`form-control ${t.mobile_number?"is-invalid":""}`,placeholder:a("Enter contact number","kivicare-clinic-management-system"),style:{height:"45px"}}})}),t.mobile_number&&e.jsx("div",{className:"invalid-feedback d-block",children:t.mobile_number.message})]}),e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-gender",children:[a("Gender","kivicare-clinic-management-system")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("select",{id:"register-gender",className:`form-select ${t.gender?"is-invalid":""}`,...m("gender",{required:a("Gender is required","kivicare-clinic-management-system")}),children:[e.jsx("option",{value:"",children:a("Select Gender","kivicare-clinic-management-system")}),e.jsx("option",{value:"male",children:a("Male","kivicare-clinic-management-system")}),e.jsx("option",{value:"female",children:a("Female","kivicare-clinic-management-system")}),ee&&e.jsx("option",{value:"other",children:a("Other","kivicare-clinic-management-system")})]}),t.gender&&e.jsx("div",{className:"invalid-feedback",children:t.gender.message})]}),e.jsxs("div",{className:"custom-form-field mb-3",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-user-role",children:[a("Select Role","kivicare-clinic-management-system")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("select",{id:"register-user-role",className:`form-select ${t.user_role?"is-invalid":""}`,...m("user_role",{required:a("Role is required","kivicare-clinic-management-system"),validate:s=>s?f.some(r=>r.value===s)||a("Selected role is not available","kivicare-clinic-management-system"):a("Please select a role","kivicare-clinic-management-system")}),defaultValue:"",children:[e.jsx("option",{value:"",children:a("Select Role","kivicare-clinic-management-system")}),f.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),t.user_role&&e.jsx("div",{className:"invalid-feedback",children:t.user_role.message})]}),b===0&&e.jsxs("div",{className:"custom-form-field mb-4",children:[e.jsxs("label",{className:"mb-2",htmlFor:"register-clinic",children:[a("Select Clinic","kivicare-clinic-management-system")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("select",{id:"register-clinic",className:`form-select ${t.user_clinic?"is-invalid":""}`,...m("user_clinic",{required:a("Clinic is required","kivicare-clinic-management-system")}),children:[e.jsx("option",{value:"",children:a("Select Clinic","kivicare-clinic-management-system")}),oe.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),t.user_clinic&&e.jsx("div",{className:"invalid-feedback",children:t.user_clinic.message})]}),T.length>0&&e.jsx("div",{className:"kc-custom-fields-section pt-2",children:e.jsx(Re,{moduleType:P,moduleId:null,control:J,errors:t,setValue:y,watch:x,showTitle:!1})}),e.jsxs("div",{className:"text-center",children:[e.jsx("button",{type:"submit",className:"btn btn-primary w-100",disabled:N||F.isPending,children:e.jsx("span",{className:"text d-inline-block align-middle text-uppercase",children:N||F.isPending?a("Loading...","kivicare-clinic-management-system"):U||a("Register","kivicare-clinic-management-system")})}),!D&&e.jsx("div",{className:"d-flex align-items-center justify-content-center mt-3",children:e.jsxs("p",{className:"text-center mb-0 fw-medium",children:[e.jsxs("span",{className:"signup-rtl-space",children:[a("Already have an account?","kivicare-clinic-management-system")," "]}),e.jsx("a",{href:"#",onClick:s=>{s.preventDefault(),R("login")},className:"text-secondary",children:A||a("Log In","kivicare-clinic-management-system")})]})})]})]})]})})]})}const Te=new qe({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}}),$e=window.kc_frontend?.locale_data||{"":{}};xe($e,"kivicare-clinic-management-system");const Me=()=>{document.querySelectorAll(".kc-register-login-container").forEach(i=>{const h=i.id;ye.createRoot(i).render(e.jsx(ve.StrictMode,{children:e.jsx(be,{client:Te,children:e.jsx(Ie,{containerId:h})})}))})};document.addEventListener("DOMContentLoaded",Me);
